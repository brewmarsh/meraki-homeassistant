/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pytest_asyncio/plugin.py:208: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.3.4, pluggy-1.6.0
rootdir: /app
configfile: pytest.ini
plugins: requests-mock-1.12.1, github-actions-annotate-failures-0.2.0, mock-3.15.1, respx-0.21.1, cov-6.0.0, homeassistant-custom-component-0.13.205, xdist-3.6.1, syrupy-4.8.0, socket-0.7.0, asyncio-0.24.0, timeout-2.3.1, sugar-1.0.0, pytest_freezer-0.4.8, unordered-0.6.1, anyio-4.12.1, picked-0.5.0, aiohttp-1.0.5
asyncio: mode=Mode.AUTO, default_loop_scope=None
collected 159 items

tests/binary_sensor/device/test_camera_motion.py ..                      [  1%]
tests/binary_sensor/device/test_mt20_open_close.py ..F                   [  3%]
tests/binary_sensor/test_switch_port.py ...                              [  5%]
tests/button/device/test_mt15_refresh_data.py ..                         [  6%]
tests/button/device/test_switch_port_cycle.py ..                         [  7%]
tests/camera/test_camera.py FFFF.....F                                   [ 13%]
tests/core/api/endpoints/test_appliance.py ........                      [ 18%]
tests/core/api/test_client.py .........                                  [ 24%]
tests/core/test_entities.py ...                                          [ 26%]
tests/core/utils/test_api_utils.py ...                                   [ 28%]
tests/core/utils/test_naming_utils.py ....                               [ 30%]
tests/core/utils/test_validation_utils.py ....                           [ 33%]
tests/discovery/handlers/test_base.py ..                                 [ 34%]
tests/discovery/handlers/test_gx.py .                                    [ 35%]
tests/discovery/handlers/test_mr.py .                                    [ 35%]
tests/discovery/handlers/test_ms.py .                                    [ 36%]
tests/discovery/handlers/test_mv.py ...                                  [ 38%]
tests/discovery/handlers/test_mx.py .                                    [ 38%]
tests/discovery/handlers/test_network.py .                               [ 39%]
tests/discovery/test_service.py ..                                       [ 40%]
tests/helpers/test_device_info_helpers.py ..                             [ 42%]
tests/helpers/test_entity_helpers.py .                                   [ 42%]
tests/helpers/test_schema.py ..                                          [ 44%]
tests/helpers/test_ssid_status_calculator.py .                           [ 44%]
tests/helpers/test_ssid_status_calculator_extended.py ....               [ 47%]
tests/hubs/test_network.py .....                                         [ 50%]
tests/hubs/test_organization.py ....                                     [ 52%]
tests/meraki_select/test_content_filtering_select.py .                   [ 53%]
tests/meraki_select/test_meraki_content_filtering.py .                   [ 54%]
tests/sensor/device/test_appliance_port.py .                             [ 54%]
tests/sensor/device/test_appliance_uplink.py .                           [ 55%]
tests/sensor/device/test_camera_analytics.py ..                          [ 56%]
tests/sensor/device/test_connected_clients.py ....                       [ 59%]
tests/sensor/device/test_data_usage.py ..                                [ 60%]
tests/sensor/device/test_device_status.py .                              [ 61%]
tests/sensor/device/test_meraki_firmware_status.py .                     [ 61%]
tests/sensor/device/test_poe_usage.py .                                  [ 62%]
tests/sensor/network/test_vlan.py .                                      [ 62%]
tests/sensor/ssid/test_ssid_connected_clients.py .                       [ 63%]
tests/sensor/test_meraki_wan1_connectivity.py .                          [ 64%]
tests/sensor/test_meraki_wan2_connectivity.py .                          [ 64%]
tests/sensor/test_network_clients.py .                                   [ 65%]
tests/sensor/test_org_clients.py ...                                     [ 67%]
tests/sensor/test_org_device_type_clients.py F                           [ 67%]
tests/sensor/test_setup_mt_sensors.py ....F                              [ 71%]
tests/services/test_device_control_service.py .                          [ 71%]
tests/services/test_network_control_service.py ..                        [ 72%]
tests/services/test_switch_port_service.py ....                          [ 75%]
tests/switch/test_adult_content_filtering.py ....                        [ 77%]
tests/switch/test_camera_profiles.py ss                                  [ 79%]
tests/switch/test_content_filtering_switch.py ..FF                       [ 81%]
tests/switch/test_meraki_ssid_device_switch.py ..                        [ 83%]
tests/switch/test_mt40_power_outlet.py ....                              [ 85%]
tests/switch/test_vlan_dhcp.py ...                                       [ 87%]
tests/test_authentication.py ...                                         [ 89%]
tests/test_camera_control.py FF                                          [ 90%]
tests/test_config_flow.py ...                                            [ 92%]
tests/test_device_naming.py ...                                          [ 94%]
tests/test_e2e_web_ui.py s                                               [ 94%]
tests/test_integration_setup.py ..                                       [ 96%]
tests/test_simple.py .                                                   [ 96%]
tests/test_ssid_device_representation.py .                               [ 97%]
tests/test_webhook.py ...                                                [ 99%]
tests/text/test_meraki_ssid_name.py .                                    [100%]

=================================== FAILURES ===================================
____________________________ test_mt20_availability ____________________________

mock_coordinator_mt20 = <MagicMock id='140378361297472'>
mock_config_entry = <MagicMock id='140378361290800'>

    def test_mt20_availability(
        mock_coordinator_mt20: MagicMock, mock_config_entry: MagicMock
    ):
        """Test sensor availability for the MT20 sensor."""
        device_info = mock_coordinator_mt20.data["devices"][0]
        sensor = MerakiMt20OpenCloseSensor(
            mock_coordinator_mt20, device_info, mock_config_entry
        )

        # Sensor should be available initially
        assert sensor.available is True

        # Test availability when readings are missing
        device_info.readings = []
        # Trigger an update to refresh state
>       sensor._handle_coordinator_update()

tests/binary_sensor/device/test_mt20_open_close.py:88:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
custom_components/meraki_ha/binary_sensor/device/mt20_open_close.py:53: in _handle_coordinator_update
    self.async_write_ha_state()
/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/homeassistant/helpers/entity.py:1020: in async_write_ha_state
    self._async_verify_state_writable()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <entity unknown.unknown=unknown>

    @callback
    def _async_verify_state_writable(self) -> None:
        """Verify the entity is in a writable state."""
        if self.hass is None:
>           raise RuntimeError(f"Attribute hass is None for {self}")
E           RuntimeError: Attribute hass is None for <entity unknown.unknown=unknown>

/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/homeassistant/helpers/entity.py:984: RuntimeError
__________________________ test_camera_stream_source ___________________________

mock_camera = <entity unknown.unknown=unknown>

    @pytest.mark.asyncio
    async def test_camera_stream_source(mock_camera: MerakiCamera) -> None:
        """
        Test the camera stream source relies on coordinator data.

        Args:
        ----
            mock_camera: The mocked camera.

        """
        # Act
        source = await mock_camera.stream_source()

        # Assert
>       assert source == "rtsp://1.2.3.4:9000/live"
E       AssertionError: assert 'rtsp://test.com/stream' == 'rtsp://1.2.3.4:9000/live'
E
E         - rtsp://1.2.3.4:9000/live
E         + rtsp://test.com/stream

tests/camera/test_camera.py:61: AssertionError
_____________________________ test_camera_turn_on ______________________________

self = <MagicMock name='mock.register_pending_update' id='140378350341680'>
args = ('Q234-ABCD-5678-camera',), kwargs = {}
msg = "Expected 'register_pending_update' to be called once. Called 0 times."

    def assert_called_once_with(self, /, *args, **kwargs):
        """assert that the mock was called exactly once and that that call was
        with the specified arguments."""
        if not self.call_count == 1:
            msg = ("Expected '%s' to be called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'register_pending_update' to be called once. Called 0 times.

/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:960: AssertionError

During handling of the above exception, another exception occurred:

hass = <HomeAssistant RUNNING>, mock_camera = <entity unknown.unknown=unknown>
mock_coordinator = <MagicMock id='140378360540112'>
mock_camera_service = <AsyncMock id='140378360755312'>

    @pytest.mark.asyncio
    async def test_camera_turn_on(
        hass: HomeAssistant,
        mock_camera: MerakiCamera,
        mock_coordinator: MagicMock,
        mock_camera_service: AsyncMock,
    ) -> None:
        """
        Test turning the camera stream on.

        Args:
        ----
            hass: The Home Assistant instance.
            mock_camera: The mocked camera.
            mock_coordinator: The mocked coordinator.
            mock_camera_service: The mocked camera service.

        """
        # Arrange
        mock_camera.hass = hass
        mock_camera.entity_id = "camera.test_camera"

        # Act
        await mock_camera.async_turn_on()

        # Assert
        mock_camera_service.async_set_rtsp_stream_enabled.assert_called_once_with(
            MOCK_CAMERA_DEVICE.serial,
            True,
        )
>       mock_coordinator.register_pending_update.assert_called_once_with(
            mock_camera.unique_id
        )
E       AssertionError: Expected 'register_pending_update' to be called once. Called 0 times.

tests/camera/test_camera.py:94: AssertionError
_____________________________ test_camera_turn_off _____________________________

self = <MagicMock name='mock.register_pending_update' id='140378350489376'>
args = ('Q234-ABCD-5678-camera',), kwargs = {}
msg = "Expected 'register_pending_update' to be called once. Called 0 times."

    def assert_called_once_with(self, /, *args, **kwargs):
        """assert that the mock was called exactly once and that that call was
        with the specified arguments."""
        if not self.call_count == 1:
            msg = ("Expected '%s' to be called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'register_pending_update' to be called once. Called 0 times.

/home/jules/.pyenv/versions/3.12.12/lib/python3.12/unittest/mock.py:960: AssertionError

During handling of the above exception, another exception occurred:

hass = <HomeAssistant RUNNING>, mock_camera = <entity unknown.unknown=unknown>
mock_coordinator = <MagicMock id='140378350348976'>
mock_camera_service = <AsyncMock id='140378350810416'>

    @pytest.mark.asyncio
    async def test_camera_turn_off(
        hass: HomeAssistant,
        mock_camera: MerakiCamera,
        mock_coordinator: MagicMock,
        mock_camera_service: AsyncMock,
    ) -> None:
        """
        Test turning the camera stream off.

        Args:
        ----
            hass: The Home Assistant instance.
            mock_camera: The mocked camera.
            mock_coordinator: The mocked coordinator.
            mock_camera_service: The mocked camera service.

        """
        # Arrange
        mock_camera.hass = hass
        mock_camera.entity_id = "camera.test_camera"

        # Act
        await mock_camera.async_turn_off()

        # Assert
        mock_camera_service.async_set_rtsp_stream_enabled.assert_called_once_with(
            MOCK_CAMERA_DEVICE.serial,
            False,
        )
>       mock_coordinator.register_pending_update.assert_called_once_with(
            mock_camera.unique_id
        )
E       AssertionError: Expected 'register_pending_update' to be called once. Called 0 times.

tests/camera/test_camera.py:129: AssertionError
________________ test_is_streaming_logic[video_settings0-True] _________________

mock_coordinator = <MagicMock id='140378350752336'>
mock_config_entry = <MagicMock id='140378350816672'>
mock_camera_service = <AsyncMock id='140378350820464'>
video_settings = {'rtspServerEnabled': True, 'rtspUrl': 'rtsp://test.com/stream'}
expected_is_streaming = True

    @pytest.mark.parametrize(
        ("video_settings", "expected_is_streaming"),
        [
            ({"rtspServerEnabled": True, "rtspUrl": "rtsp://test.com/stream"}, True),
            ({"rtspServerEnabled": False, "rtspUrl": "rtsp://test.com/stream"}, False),
            ({"rtspServerEnabled": True, "rtspUrl": None}, False),
            ({"rtspServerEnabled": True, "rtspUrl": "http://test.com/stream"}, False),
            ({"rtspUrl": "rtsp://test.com/stream"}, False),
        ],
    )
    def test_is_streaming_logic(
        mock_coordinator: MagicMock,
        mock_config_entry: MagicMock,
        mock_camera_service: AsyncMock,
        video_settings: dict,
        expected_is_streaming: bool,
    ) -> None:
        """
        Test the logic of the is_streaming property.

        Args:
        ----
            mock_coordinator: The mocked coordinator.
            mock_config_entry: The mocked config entry.
            mock_camera_service: The mocked camera service.
            video_settings: The video settings to test.
            expected_is_streaming: The expected result.

        """
        # Arrange
        mock_device_data = dataclasses.replace(
            MOCK_CAMERA_DEVICE,
            video_settings=video_settings,
            # Ensure lanIp is None for this test to isolate rtspUrl logic
            lan_ip=None,
            rtsp_url=video_settings.get("rtspUrl"),
        )
        # The entity is initialized with this data, so we pass it directly
        camera = MerakiCamera(
            mock_coordinator,
            mock_config_entry,
            mock_device_data,
            mock_camera_service,
        )

        # Act & Assert
>       assert camera.is_streaming == expected_is_streaming
E       assert False == True
E        +  where False = <entity unknown.unknown=unknown>.is_streaming

tests/camera/test_camera.py:180: AssertionError
________________________ test_entity_disabled_if_no_url ________________________

mock_coordinator = <MagicMock id='140378350966912'>
mock_config_entry = <MagicMock id='140378349577728'>
mock_camera_service = <AsyncMock id='140378349475824'>

    def test_entity_disabled_if_no_url(
        mock_coordinator: MagicMock,
        mock_config_entry: MagicMock,
        mock_camera_service: AsyncMock,
    ) -> None:
        """
        Test that the camera entity is disabled if no stream URL is available.

        Args:
        ----
            mock_coordinator: The mocked coordinator.
            mock_config_entry: The mocked config entry.
            mock_camera_service: The mocked camera service.

        """
        # Arrange
        # Create a mock device with no way to determine a stream URL
        mock_device_no_url = dataclasses.replace(
            MOCK_CAMERA_DEVICE,
            video_settings={
                "rtspServerEnabled": True,
                "rtspUrl": None,
            },
            lan_ip=None,
        )

        # Act
        camera = MerakiCamera(
            mock_coordinator,
            mock_config_entry,
            mock_device_no_url,
            mock_camera_service,
        )

        # Assert
>       assert not camera.entity_registry_enabled_default
E       assert not True
E        +  where True = <entity unknown.unknown=unknown>.entity_registry_enabled_default

tests/camera/test_camera.py:259: AssertionError
_____________ test_meraki_organization_device_type_clients_sensor ______________

hass = <HomeAssistant RUNNING>

    async def test_meraki_organization_device_type_clients_sensor(
        hass: HomeAssistant,
    ) -> None:
        """Test the Meraki organization device type clients sensor."""
        coordinator = MagicMock()
        coordinator.data = {
            "clients": [
                {"deviceType": "wireless"},
                {"deviceType": "wireless"},
                {"deviceType": "appliance"},
            ]
        }
        config_entry = MagicMock()
        config_entry.options = {}
        sensor = MerakiOrganizationDeviceTypeClientsSensor(
            coordinator, config_entry, "wireless"
        )
>       sensor._update_sensor_data()
E       AttributeError: 'MerakiOrganizationDeviceTypeClientsSensor' object has no attribute '_update_sensor_data'

tests/sensor/test_org_device_type_clients.py:30: AttributeError
______________________________ test_availability _______________________________

mock_coordinator_with_mt_devices = <MagicMock id='140378361057920'>

    def test_availability(mock_coordinator_with_mt_devices: MagicMock) -> None:
        """Test sensor availability."""
        device = mock_coordinator_with_mt_devices.data["devices"][0]  # MT10
        entities = async_setup_mt_sensors(mock_coordinator_with_mt_devices, device)
        temp_sensor = entities[0]
        temp_sensor.hass = MagicMock()
        temp_sensor.entity_id = "sensor.test"
        temp_sensor.async_write_ha_state = MagicMock()
        temp_sensor._handle_coordinator_update()

        # Sensor should be available
        assert temp_sensor.available is True

        # Remove readings and check availability
        device_without_readings = copy.deepcopy(device)
        device_without_readings.readings = []
        mock_coordinator_with_mt_devices.get_device.side_effect = None
        mock_coordinator_with_mt_devices.get_device.return_value = device_without_readings
        temp_sensor._handle_coordinator_update()
>       assert temp_sensor.available is False
E       assert True is False
E        +  where True = <entity unknown.unknown=unknown>.available

tests/sensor/test_setup_mt_sensors.py:262: AssertionError
_________________________________ test_turn_on _________________________________

mock_coordinator_with_content_filtering = <MagicMock id='140378350913248'>
mock_config_entry = <MagicMock id='140378360959472'>

    async def test_turn_on(
        mock_coordinator_with_content_filtering: MagicMock, mock_config_entry: MagicMock
    ) -> None:
        """Test turning the switch on."""
        network = MerakiNetwork(id="net_1", name="Test Network", organization_id="org1")
        category = {"id": "meraki:contentFiltering/category/1", "name": "Social Media"}
        switch = MerakiContentFilteringSwitch(
            mock_coordinator_with_content_filtering, mock_config_entry, network, category
        )

        with (
            patch.object(
                switch._client.appliance,
                "get_network_appliance_content_filtering",
                new_callable=AsyncMock,
                return_value={
                    "blockedUrlCategories": ["meraki:contentFiltering/category/2"]
                },
            ) as mock_get,
            patch.object(
                switch._client.appliance,
                "update_network_appliance_content_filtering",
                new_callable=AsyncMock,
            ) as mock_update,
        ):
>           await switch.async_turn_on()

tests/switch/test_content_filtering_switch.py:93:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
custom_components/meraki_ha/switch/content_filtering.py:81: in async_turn_on
    await self._async_update_content_filtering(add=True)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <entity unknown.unknown=unknown>, add = True

    async def _async_update_content_filtering(self, add: bool) -> None:
        """
        Update the content filtering settings.

        Args:
        ----
            add: Whether to add or remove the category.

        """
        current_settings = (
            await self._client.appliance.get_network_appliance_content_filtering(
>               self._network["id"],
            )
        )
E       TypeError: 'MerakiNetwork' object is not subscriptable

custom_components/meraki_ha/switch/content_filtering.py:105: TypeError
________________________________ test_turn_off _________________________________

mock_coordinator_with_content_filtering = <MagicMock id='140378350224496'>
mock_config_entry = <MagicMock id='140378361290224'>

    async def test_turn_off(
        mock_coordinator_with_content_filtering: MagicMock, mock_config_entry: MagicMock
    ) -> None:
        """Test turning the switch off."""
        network = MerakiNetwork(id="net_1", name="Test Network", organization_id="org1")
        category = {"id": "meraki:contentFiltering/category/2", "name": "Gambling"}
        switch = MerakiContentFilteringSwitch(
            mock_coordinator_with_content_filtering, mock_config_entry, network, category
        )

        with (
            patch.object(
                switch._client.appliance,
                "get_network_appliance_content_filtering",
                new_callable=AsyncMock,
                return_value={
                    "blockedUrlCategories": ["meraki:contentFiltering/category/2"]
                },
            ) as mock_get,
            patch.object(
                switch._client.appliance,
                "update_network_appliance_content_filtering",
                new_callable=AsyncMock,
            ) as mock_update,
        ):
>           await switch.async_turn_off()

tests/switch/test_content_filtering_switch.py:130:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
custom_components/meraki_ha/switch/content_filtering.py:92: in async_turn_off
    await self._async_update_content_filtering(add=False)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <entity unknown.unknown=unknown>, add = False

    async def _async_update_content_filtering(self, add: bool) -> None:
        """
        Update the content filtering settings.

        Args:
        ----
            add: Whether to add or remove the category.

        """
        current_settings = (
            await self._client.appliance.get_network_appliance_content_filtering(
>               self._network["id"],
            )
        )
E       TypeError: 'MerakiNetwork' object is not subscriptable

custom_components/meraki_ha/switch/content_filtering.py:105: TypeError
____________________ test_camera_turn_on_optimistic_update _____________________

hass = <HomeAssistant RUNNING>
mock_coordinator = <MagicMock id='140378349200416'>
mock_config_entry = <MagicMock id='140378349484704'>
mock_camera_service = <AsyncMock id='140378381880784'>

    @pytest.mark.asyncio
    async def test_camera_turn_on_optimistic_update(
        hass: HomeAssistant,
        mock_coordinator: MagicMock,
        mock_config_entry: MagicMock,
        mock_camera_service: AsyncMock,
    ) -> None:
        """
        Test that turning on the camera optimistically updates the coordinator.

        Args:
        ----
            hass: The Home Assistant instance.
            mock_coordinator: The mocked coordinator.
            mock_config_entry: The mocked config entry.
            mock_camera_service: The mocked camera service.

        """
        # Arrange
        device_data = mock_coordinator.data["devices"][0]
        camera = MerakiCamera(
            mock_coordinator,
            mock_config_entry,
            device_data,
            mock_camera_service,
        )
        camera.hass = hass
        camera.entity_id = "camera.test_camera"

        # Act
>       await camera.async_turn_on()

tests/test_camera_control.py:81:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <entity unknown.unknown=unknown>

    async def async_turn_on(self) -> None:
        """Turn on the camera stream."""
        _LOGGER.debug("Turning on stream for camera %s", self._device_serial)
        await self._camera_service.async_set_rtsp_stream_enabled(
            self._device_serial, True
        )
>       await self.coordinator.async_request_refresh()
E       TypeError: object MagicMock can't be used in 'await' expression

custom_components/meraki_ha/camera.py:185: TypeError
____________________ test_camera_turn_off_optimistic_update ____________________

hass = <HomeAssistant RUNNING>
mock_coordinator = <MagicMock id='140378361283936'>
mock_config_entry = <MagicMock id='140378350969168'>
mock_camera_service = <AsyncMock id='140378350971808'>

    @pytest.mark.asyncio
    async def test_camera_turn_off_optimistic_update(
        hass: HomeAssistant,
        mock_coordinator: MagicMock,
        mock_config_entry: MagicMock,
        mock_camera_service: AsyncMock,
    ) -> None:
        """
        Test that turning off the camera optimistically updates the coordinator.

        Args:
        ----
            hass: The Home Assistant instance.
            mock_coordinator: The mocked coordinator.
            mock_config_entry: The mocked config entry.
            mock_camera_service: The mocked camera service.

        """
        # Arrange
        # Start with the camera on
        device_data = mock_coordinator.data["devices"][0]
        # We must replace since it is a dataclass and might be immutable-ish for tests (though fields are mutable)
        # But let's just modify the dicts inside
        device_data.video_settings["rtspServerEnabled"] = True
        device_data.video_settings["rtspUrl"] = "rtsp://192.168.1.100:9000/live"

        camera = MerakiCamera(
            mock_coordinator,
            mock_config_entry,
            device_data,
            mock_camera_service,
        )
        camera.hass = hass
        camera.entity_id = "camera.test_camera"

        # Act
>       await camera.async_turn_off()

tests/test_camera_control.py:138:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <entity unknown.unknown=unknown>

    async def async_turn_off(self) -> None:
        """Turn off the camera stream."""
        _LOGGER.debug("Turning off stream for camera %s", self._device_serial)
        await self._camera_service.async_set_rtsp_stream_enabled(
            self._device_serial, False
        )
>       await self.coordinator.async_request_refresh()
E       TypeError: object MagicMock can't be used in 'await' expression

custom_components/meraki_ha/camera.py:193: TypeError
=========================== short test summary info ============================
FAILED tests/binary_sensor/device/test_mt20_open_close.py::test_mt20_availability
FAILED tests/camera/test_camera.py::test_camera_stream_source - AssertionErro...
FAILED tests/camera/test_camera.py::test_camera_turn_on - AssertionError: Exp...
FAILED tests/camera/test_camera.py::test_camera_turn_off - AssertionError: Ex...
FAILED tests/camera/test_camera.py::test_is_streaming_logic[video_settings0-True]
FAILED tests/camera/test_camera.py::test_entity_disabled_if_no_url - assert n...
FAILED tests/sensor/test_org_device_type_clients.py::test_meraki_organization_device_type_clients_sensor
FAILED tests/sensor/test_setup_mt_sensors.py::test_availability - assert True...
FAILED tests/switch/test_content_filtering_switch.py::test_turn_on - TypeErro...
FAILED tests/switch/test_content_filtering_switch.py::test_turn_off - TypeErr...
FAILED tests/test_camera_control.py::test_camera_turn_on_optimistic_update - ...
FAILED tests/test_camera_control.py::test_camera_turn_off_optimistic_update
================== 12 failed, 144 passed, 3 skipped in 19.01s ==================
