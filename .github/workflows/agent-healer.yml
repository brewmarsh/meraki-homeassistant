name: Agent Healer

on:
  workflow_run:
    workflows: ["Validate Code"]
    types: [completed]

jobs:
  heal:
    # Only trigger if the previous workflow failed on the beta branch
    if: ${{ github.event.workflow_run.conclusion == 'failure' && github.event.workflow_run.head_branch == 'beta' }}
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Jules to Fix CI
        uses: google-labs-code/jules-invoke@main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          base_branch: "beta"
          # This prompt gives Jules the specific context of the failure
          instructions: |
            The 'Validate Code' workflow for the Meraki integration failed on the beta branch.
            1. Read the logs from the failed workflow.
            2. Identify the linting or test errors.
            3. Apply fixes to the current branch to make the CI pass.
