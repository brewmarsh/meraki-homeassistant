
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">









      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">



        <title>Updated Design and Implementation Plan: Parental Controls & Content Filtering - Meraki Home Assistant Integration</title>



      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>





  </head>


    <body dir="ltr">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#updated-design-and-implementation-plan-parental-controls-content-filtering" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>






<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Meraki Home Assistant Integration" class="md-header__button md-logo" aria-label="Meraki Home Assistant Integration" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Meraki Home Assistant Integration
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Updated Design and Implementation Plan: Parental Controls &amp; Content Filtering

          </span>
        </div>
      </div>
    </div>


      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>





        <label class="md-header__button md-icon" for="__search">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>



  </nav>

</header>

    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Meraki Home Assistant Integration" class="md-nav__button md-logo" aria-label="Meraki Home Assistant Integration" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Meraki Home Assistant Integration
  </label>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">



  <span class="md-ellipsis">


    Home



  </span>



      </a>
    </li>














    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >


          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">



  <span class="md-ellipsis">


    User Guide



  </span>



            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>


    User Guide


          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../user/setup/" class="md-nav__link">



  <span class="md-ellipsis">


    Setup



  </span>



      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../user/entities/" class="md-nav__link">



  <span class="md-ellipsis">


    Entities



  </span>



      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../user/troubleshooting/" class="md-nav__link">



  <span class="md-ellipsis">


    Troubleshooting



  </span>



      </a>
    </li>




          </ul>
        </nav>

    </li>














    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >


          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">



  <span class="md-ellipsis">


    Developer Guide



  </span>



            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>


    Developer Guide


          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../internal/architecture/" class="md-nav__link">



  <span class="md-ellipsis">


    Architecture



  </span>



      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../internal/testing/TEST_SERVER/" class="md-nav__link">



  <span class="md-ellipsis">


    Testing



  </span>



      </a>
    </li>




          </ul>
        </nav>

    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#1-product-vision-scope" class="md-nav__link">
    <span class="md-ellipsis">

        1. Product Vision &amp; Scope

    </span>
  </a>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">

              <article class="md-content__inner md-typeset">





<h1 id="updated-design-and-implementation-plan-parental-controls-content-filtering">Updated Design and Implementation Plan: Parental Controls &amp; Content Filtering</h1>
<h2 id="1-product-vision-scope">1. Product Vision &amp; Scope</h2>
<p>The goal is to empower users with an intuitive and responsive interface to manage parental controls on their home network via Home Assistant, leveraging the power of their Meraki MX Security Appliance. This plan prioritizes <strong>simplicity and safety</strong> to ensure the integration is reliable and does not negatively impact existing network configurations.</p>
<p>This plan will focus on two core features:</p>
<ul>
<li><strong>Network-wide content filtering via policy selection.</strong></li>
<li><strong>On-demand device-level internet blocking ("time-out").</strong></li>
</ul>
<hr />
<p>*<strong>*2. Core Features &amp; User Stories</strong></p>
<ul>
<li><strong>Content Filtering Policy Selection:</strong> * <strong>User Story:</strong> As a parent, I want to quickly switch my networkâ€™s content filtering policy from "school" to "gaming" to "bedtime" directly from Home Assistant, so I can easily manage my family's internet access throughout the day.</li>
<li>
<p><strong>Implementation:</strong> A <code>select</code> entity will be exposed for each Meraki network, allowing the user to choose from a list of predefined content filtering policies from the Meraki dashboard.</p>
</li>
<li>
<p><strong>On-Demand Device Internet "Time-Out":</strong></p>
</li>
<li><strong>User Story:</strong> As a parent, I want to instantly disable internet access for my child's device, so I can enforce a "time-out" when they're not listening.</li>
<li><strong>Implementation:</strong> A <code>switch</code> entity will be created for each detected client device. Toggling this switch will create or remove a device-specific Layer 7 (L7) firewall rule, blocking all internet traffic for that client.</li>
</ul>
<hr />
<p>*<strong>*3. Technical Design</strong></p>
<h1 id="31-home-assistant-entities">*<strong>*3.1. Home Assistant Entities</strong></h1>
<ul>
<li><strong>Entity 1: Content Filtering <code>select</code> Entity</strong></li>
<li><strong>Entity ID:</strong> <code>select.meraki_content_filtering_policy_&lt;network_name_slug&gt;</code></li>
<li><strong>Function:</strong> This entity will pull the list of available content filtering policies from the Meraki dashboard. The agent must handle the retrieval of these policy names, including the default categories (<code>Block all</code>, <code>Adult themes</code>, etc.) and any custom policies.</li>
<li>
<p><strong>API Calls:</strong> * <code>GET /networks/{networkId}/appliance/contentFiltering</code> (for initial state)</p>
<ul>
<li><code>PUT /networks/{networkId}/appliance/contentFiltering</code> (for state change)</li>
</ul>
</li>
<li>
<p><strong>Entity 2: Client <code>switch</code> Entity</strong></p>
</li>
<li><strong>Entity ID:</strong> <code>switch.meraki_client_internet_access_&lt;client_mac_address_slug&gt;</code></li>
<li><strong>Function:</strong> This entity's state will reflect the internet access status for a specific device. Toggling the switch will create or delete a specific L7 firewall rule for that device.</li>
<li><strong>API Calls:</strong><ul>
<li><code>GET /networks/{networkId}/clients</code> (to get a list of clients and their MAC/IP)</li>
<li><code>GET /networks/{networkId}/appliance/firewall/l7FirewallRules</code> (to check for existing rules)</li>
<li><code>PUT /networks/{networkId}/appliance/firewall/l7FirewallRules</code> (to add/remove rules)</li>
</ul>
</li>
</ul>
<h1 id="32-meraki-api-interaction">*<strong>*3.2. Meraki API Interaction</strong></h1>
<ul>
<li><strong>Content Filtering:</strong> The API endpoints are correctly identified. The agent should be aware that the <code>PUT</code> request to update content filtering requires the entire object, including the <code>allowedUrlPatterns</code> and <code>blockedUrlPatterns</code>. It should <strong>read the current state first, update only the policy, and then write the complete object back</strong>.</li>
<li>
<p><strong>Client Firewall Rules:</strong> This is the most critical part of the implementation. The agent must:</p>
</li>
<li>
<p>Use a unique comment to identify its rules. <strong>Suggestion:</strong> <code>{"comment": "Managed by Home Assistant Meraki Parental Controls"}</code>. This is essential to prevent conflicts with manually created rules.</p>
</li>
<li>When a switch is toggled <strong>on</strong> (to block), the agent will add a new L7 firewall rule with the specific client's IP address.</li>
<li><strong>Rule Type:</strong> Deny</li>
<li><strong>Protocol:</strong> Any</li>
<li><strong>Port:</strong> Any</li>
<li><strong>URL Pattern:</strong> <code>*</code></li>
<li><strong>Client IP:</strong> The IP of the device. The agent will need to get the IP address from the <code>/networks/{networkId}/clients</code> endpoint.</li>
<li>When a switch is toggled <strong>off</strong> (to allow), the agent will find the rule with the unique comment and the matching client IP and remove it from the list of rules before sending the <code>PUT</code> request.</li>
<li><strong>Important:</strong> The Meraki API has an endpoint to get a client's IP address (<code>GET /networks/{networkId}/clients/{clientId}/status</code>). The agent should use this to get the IP, as the <code>/networks/{networkId}/clients</code> endpoint might not always have the most up-to-date IP address.</li>
</ul>
<h1 id="33-state-management-polling">*<strong>*3.3. State Management &amp; Polling</strong></h1>
<ul>
<li>The integration must poll the Meraki API at a reasonable interval (e.g., every 3-5 minutes) to update the state of the Home Assistant entities.</li>
<li>The <code>select</code> entity's state should reflect the current Meraki network policy.</li>
<li>The <code>switch</code> entities' states should reflect the presence or absence of the corresponding L7 firewall rules. This ensures the Home Assistant UI stays in sync with the Meraki configuration, even if changes are made outside of Home Assistant.</li>
</ul>
<hr />
<p>*<strong>*4. Risks &amp; Mitigations</strong></p>
<ul>
<li><strong>Risk:</strong> Overwriting user-defined firewall rules.</li>
<li>
<p><strong>Mitigation:</strong> The plan to use a unique comment is the correct approach. The agent <strong>must only modify rules that contain this specific comment</strong>. All other rules must be preserved.</p>
</li>
<li>
<p><strong>Risk:</strong> Meraki API rate limiting.</p>
</li>
<li>
<p><strong>Mitigation:</strong> The agent should implement a delay or a queue for multiple API calls (e.g., when a user rapidly toggles several switches). Polling intervals should be carefully considered to avoid hitting the API too frequently.</p>
</li>
<li>
<p><strong>Risk:</strong> The Meraki device loses connection or the API key is invalid.</p>
</li>
<li><strong>Mitigation:</strong> The integration should use robust error handling. If an API call fails, the entity state should be set to <code>unavailable</code>, and an error message should be logged in Home Assistant.</li>
</ul>
<hr />
<p>*<strong>*5. Additional &amp; Optional Features</strong></p>
<p>Based on the capabilities of Meraki devices, here are a few more advanced features that would significantly enhance the user experience and create a more robust parental controls solution.</p>
<ul>
<li><strong>Scheduled Access (Time-based Rules):</strong></li>
<li><strong>Concept:</strong> Instead of just an on/off switch, allow users to set schedules for internet access. This could be exposed as a <strong>Home Assistant schedule helper entity</strong>.</li>
<li><strong>How it works:</strong> The integration would manage L7 firewall rules that are only active during specific times (e.g., blocking social media from 9 PM to 7 AM). The Meraki API supports time-of-day-based rules.</li>
<li>
<p><strong>Value:</strong> Automates a common use case for parental controls, reducing the need for manual intervention.</p>
</li>
<li>
<p><strong>Application &amp; URL Blocking:</strong></p>
</li>
<li><strong>Concept:</strong> Provide a user interface to block specific applications (e.g., "YouTube," "Fortnite") or custom URLs for a device.</li>
<li><strong>How it works:</strong> Meraki's L7 firewall rules support blocking by application, application category, and URL. The integration could expose a new entity or a service call in Home Assistant for this.</li>
<li>
<p><strong>Value:</strong> Offers more granular control than simple on/off. Parents could block specific games or websites without disabling all internet access.</p>
</li>
<li>
<p><strong>Client Information &amp; Monitoring:</strong></p>
</li>
<li><strong>Concept:</strong> Expose more information about client devices as sensors in Home Assistant.</li>
<li><strong>How it works:</strong> Create sensors for <strong>data usage (downlink/uplink)</strong>, <strong>current IP address</strong>, and <strong>connected wireless network name/SSID</strong>.</li>
<li><strong>Value:</strong> Provides a single-pane-of-glass view for monitoring network activity, which is a key part of parental controls. This leverages Meraki's powerful network visibility features.</li>
</ul>













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>





      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>


      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>


  </body>
</html>