<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Frontend Verification</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; margin: 20px; }
    </style>
</head>
<body>
    <h1>Meraki Panel Verification</h1>
    <div id="panel-container"></div>
    <script src="./meraki-panel.js"></script>
    <script>
        const mockDevices = [
            { serial: 'MT10_1', name: 'MT10 Temp', model: 'MT10', status: 'online', networkId: 'N_1', readings: [{ metric: 'temperature', temperature: { celsius: 20.5 } }] },
            { serial: 'MT12_1', name: 'MT12 Water', model: 'MT12', status: 'online', networkId: 'N_1', readings: [{ metric: 'water', water: { present: true } }] },
            { serial: 'MT14_1', name: 'MT14 TVOC', model: 'MT14', status: 'online', networkId: 'N_1', readings: [{ metric: 'tvoc', tvoc: { concentration: 150 } }] },
            { serial: 'MT15_1', name: 'MT15 TVOC', model: 'MT15', status: 'online', networkId: 'N_1', readings: [{ metric: 'tvoc', tvoc: { concentration: 300 } }] },
            { serial: 'MT20_1', name: 'MT20 Door', model: 'MT20', status: 'online', networkId: 'N_1', readings: [{ metric: 'door', door: { open: false } }] },
            { serial: 'MT40_1', name: 'MT40 Power', model: 'MT40', status: 'online', networkId: 'N_1', entities: [{ entity_id: 'switch.mt40_outlet', domain: 'switch' }] },
            { serial: 'MT10_OFFLINE', name: 'MT10 Offline', model: 'MT10', status: 'offline', networkId: 'N_1' },
            { serial: 'MT10_DORMANT', name: 'MT10 Dormant', model: 'MT10', status: 'dormant', networkId: 'N_1' },
            { serial: 'NON_MT_1', name: 'MR Access Point', model: 'MR33', status: 'online', networkId: 'N_1' },
            { serial: 'NON_MT_2', name: 'MS Switch', model: 'MS220', status: 'alerting', networkId: 'N_1' },
        ];

        const mockHass = {
            states: {
                'switch.mt40_outlet': { state: 'on' }
            },
            themes: { darkMode: true },
            callWS: (msg) => {
                console.log('callWS', msg);
                if (msg.type === 'meraki_ha/get_config') {
                    return Promise.resolve({
                        networks: [{ id: 'N_1', name: 'Test Network', is_enabled: true, productTypes: ['sensor', 'wireless', 'switch'] }],
                        devices: mockDevices,
                        vlans: {}
                    });
                }
                if (msg.type === 'meraki_ha/update_enabled_networks') {
                    return Promise.resolve({});
                }
                return Promise.resolve({});
            }
        };

        const panelConfig = {
            config: {
                title: 'Meraki Network'
            }
        };

        // Wait for element definition
        customElements.whenDefined('meraki-panel').then(() => {
            const el = document.createElement('meraki-panel');
            el.hass = mockHass;
            el.panel = panelConfig;
            document.getElementById('panel-container').appendChild(el);
        });
    </script>
</body>
</html>
